var stats, scene, renderer;
var camera, cameraControls;
var terrainMap;
var resourcePaths;
var resourceRules;
var resourcePositions = {"pine-gray":[[-0.31106591736897826,2862.7240810259245],[17.765943143051118,3105.481602845248],[18.404763942118734,208.80277652619407],[25.853617009241134,3262.3486386216246],[26.526520002167672,2161.341200687457],[28.7183626354672,2492.551152075641],[41.33584510628134,545.6342383427545],[54.448853203095496,2842.185479236301],[55.099657418206334,343.8592537306249],[57.93166305636987,2279.2539324131794],[60.50912948464975,3312.1790856085718],[60.75978096295148,369.7214607652277],[63.62713633896783,671.2998488009907],[62.12432475667447,1705.438554939814],[64.50924583198503,719.4096627859399],[74.33676626998931,421.6907162168063],[90.89692786894739,3210.4873184249736],[94.17110133497044,2787.3365957108326],[104.95435360493138,2500.259096321184],[114.23395084915683,1415.3937881370075],[156.82726530730724,2421.401637654286],[165.34592474298552,805.6579758808948],[166.57773385662585,691.2134778946638],[166.36924659274518,711.7008477356285],[171.12506622774526,894.3797703026794],[180.91002168040723,741.8816436491907],[187.23699590051547,364.15855316771194],[210.62958218436688,630.3539431015961],[258.1195173780434,2176.4695874322206],[271.08564107120037,2517.3412226946093],[299.00288850208744,1700.1642057751305],[306.9485436156392,2251.748380044941],[319.5850475230254,1596.630614043679],[337.710992296692,2542.8792529553175],[345.15401436714455,2505.4721372965723],[363.7239761813544,2156.7400305164047],[368.96270103612915,2109.0544980973937],[382.5969699495472,2761.9739056210965],[405.83445612108335,2447.121859799605],[414.0333782774396,2021.9513895371929],[448.19831129396334,2994.7584001715295],[455.0351438350044,2492.2949674874544],[459.8572844816372,3432.569417149294],[468.24275243189186,2432.8087225994095],[471.8696666941978,2499.9501933390275],[473.03945322474465,3883.06259422563],[491.3781631626189,3316.1156651778147],[506.2991690034978,3011.3416984523647],[555.3024227339774,2918.5917036947794],[567.1700239432976,2861.2372056371532],[568.2581110890023,3252.1902710669674],[577.1149130486883,3347.5436217286624],[578.3024679459631,2637.567654723767],[595.7174677671865,3752.264024030417],[639.8701775013469,2802.5696747582406],[648.511434418615,2645.0026245769113],[647.1257234024815,3236.5327564757317],[666.1212997063994,3726.419097510632],[731.1529339118861,2682.2574701071717],[740.0324246319942,2646.2219840209],[748.2304150159471,1837.8220432861708],[755.0322010722011,1900.3183421231806],[803.5623057289049,3705.740820122417],[820.1636548098177,1701.2464065793902],[840.1206704964861,3678.078462456353],[849.432799463626,1963.0021321680397],[857.7928372165188,1797.23569582263],[871.1699936096556,1578.3766192873009],[900.8119229134172,2770.904861788731],[911.5569375436753,2016.3159456294961],[918.0988972764462,2760.2210359242745],[921.0834996956401,1552.8636274277233],[933.814692562446,2729.044955044985],[968.4413008377887,1873.0282094562426],[990.4654841772281,3810.1034279372543],[1003.1762778204866,3366.554962239228],[1014.6488484372385,3230.229624035768],[1020.7367222728208,2190.255037284456],[1022.1626378311776,2271.844121889677],[1033.605217433069,1998.3510396038182],[1040.096570359543,3638.5367590840906],[1042.2151715005748,2254.440536179114],[1058.00471541984,1478.204821971245],[1066.3448717594147,2976.6979310754687],[1137.3881524410099,3446.4665551437065],[1171.1015977123752,994.8757714466192],[1194.5391372344457,2778.3709139740095],[1202.8035415783525,1407.1093754181638],[1211.4474204853177,2862.8606864153408],[1225.3208082402125,972.0409246073104],[1351.2161889811978,1650.4005085937679],[1365.0292833885178,1563.1113180075772],[1366.1479193964042,1622.08197595831],[1394.9814362777397,1035.0319532314315],[1476.201521939598,2044.171954723075],[1487.1642074766569,1758.726498818025],[1531.8688759692013,1797.5907876924612],[1534.5549831921235,1673.0689059775323],[1550.7406093035825,1498.7733928770758],[1634.634661698714,1360.8082494190894],[1657.2207310763188,978.9082347289659],[1721.220738010481,885.629435247276],[1720.9373410600238,1525.370493590366],[1722.089699987322,1328.393148324918],[1827.7382576013915,1391.1375253344886],[1835.6997651490383,859.9677699995227],[1854.1258412236348,796.1816028105095],[1859.4323357781395,855.0556898871437],[2463.5255062626675,3497.775260827504],[2550.110880327411,3707.097713537514],[2599.926500156522,3433.4055122956634],[2642.7488776561804,1794.8047194946557],[2686.442917110864,3726.141210455913],[2780.683242491912,1636.2803243813105],[2817.0249178288504,1446.4829001906328],[2817.1742985509336,3678.1926131094806],[2818.398353842087,1775.1631455481984],[2853.0460306787863,3542.3751317556016],[2872.072069944814,1447.6062415242195],[2920.342283530161,3422.1825748579577],[2956.9723563278094,3481.41058109235],[2967.3620821237564,3329.2353507177904],[2985.722613134887,3688.645939097274],[3002.6732357610017,3519.9295422793366],[3025.486561510712,2303.904490226414],[3042.4002442411147,1304.2708372394554],[3044.151526933536,3244.7450498905964],[3111.72907562973,931.8672503861599],[3111.9238185696304,2298.914288577158],[3119.13227079669,2620.84523485275],[3149.11421194626,2726.602528894786],[3155.5232533891685,2344.8122563711368],[3157.0088484170847,2572.1602220884524],[3162.6099369958974,2810.7864454132505],[3163.581157825887,2363.924739604816],[3175.490991938859,1404.8786806752905],[3188.727902158629,2301.5372442901134],[3193.9714036192745,2495.8929193089716],[3199.810049007181,2222.0037190103903],[3215.4311747946776,853.3315659458749],[3218.31933678966,2172.3891478604637],[3294.166928194929,3170.357075168751],[3295.828753768932,3229.726442308165],[3309.574290127028,885.896278959699],[3329.0435470221564,1600.6480463985354],[3332.247827622574,1621.5417832303792],[3334.2547920858487,3171.8490323913284],[3393.0043464507908,1490.2101105405018],[3396.361224064138,1591.5970695721917],[3434.1097298632376,3130.488830455113],[3438.17414509831,3154.077323045116],[3466.2402306869626,864.4087082454935],[3535.6043688962236,1084.4822826497257],[3597.943160793744,3107.487010933459],[3708.7727465713397,3106.7217285074294],[3724.9205102189444,1152.1307065468282]],"maple-green-gray":[[2.763863895088434,3548.700895143673],[375.37378647737205,637.1174150793813],[380.93368988251314,1207.73157691909],[466.7858706051484,1499.6737850834616],[492.9286331599578,1343.4891010397114],[497.9059390956536,1783.1327363378368],[513.6758253159933,160.21438144240528],[529.7254982739687,987.2041621310636],[588.6689416258596,1961.7435808745213],[595.8002409068868,1033.4411280765198],[616.2550791040994,9.098455712664872],[793.4623757186346,201.94457652466372],[1185.0469755008817,4033.6622298811562],[1186.1100783981383,3266.0170826264657],[1335.2325569181703,1907.7420151820406],[1475.1487322445028,3051.441405745689],[1498.8379044570029,2956.27543948777],[1512.0027229883708,2841.9578220434487],[1550.915177475661,2983.984701405745],[1577.3564053107984,1935.0705774566159],[1632.6266359975561,3057.2621650747024],[1640.0118290507235,2736.833858234342],[1734.6748685026541,2357.484938989859],[1771.523003485985,1690.3511733710766],[1873.3377130459994,2629.5354367243126],[1873.052750322502,2985.5000325092115],[1949.2022160878405,974.9978259238414],[1961.287578606978,949.9932274241],[2204.1142210429534,2422.881262090057],[2341.9768365966156,2611.2454426428303],[2359.9690549029037,2986.5117439068854],[2409.8620901182294,3791.9323459011503],[2443.6517680669203,2136.90329242032],[2472.636181982234,2376.363515332341],[2474.2472751550376,2862.201186142862],[2510.0871816962026,3346.1084045628086],[2615.0826689451933,1700.2493824567646],[2834.5692882062867,3815.442065694835],[2848.4551465921104,2665.94562495267],[2862.6964034396224,3729.7659366917796],[2870.30080273794,2633.036419847049],[2954.671235122718,2449.0094958697446],[2960.4056761977263,2979.671634437982],[3162.3986062365584,3376.321387853939],[3378.4292332981713,2656.4544469588436],[3577.9233579137363,2766.5736516932957],[3613.300863926299,3141.8970168386586],[3657.082591264043,2937.4612595513463]],"pine-brown":[[16.410692969802767,3502.986384632997],[46.8321882719174,2311.4376570577733],[47.45349416229874,1497.9478986538015],[49.090685818344355,2729.7955253673717],[58.130772111937404,1588.1022052173503],[60.89098603511229,1034.9094374161214],[61.086213840637356,3241.4942392189987],[66.01744107855484,2239.301585210953],[70.73366871336475,339.0720670921728],[101.83741216966882,1780.0743226748891],[106.6235744887963,2778.939747946337],[110.25870989076793,356.76137083629146],[115.01438977522776,1533.1185770081356],[124.57896872842684,1480.6346759186126],[129.24524745671079,1857.4205274344422],[133.11539314175025,2551.7930873408914],[136.09946717647836,848.7009890293702],[137.15353904198855,2151.573849637527],[140.63753797020763,1620.7606214759871],[141.45009633153677,2373.6066464930773],[143.29454491566867,2685.463954883162],[145.1151920822449,594.0289314836264],[160.30193739943206,1972.2270374093205],[173.40195215912536,2483.383828799706],[174.0291177635081,475.438279225491],[178.34363480377942,382.83433818724006],[178.31480745226145,2610.741984225344],[181.85880105011165,1818.567023305688],[182.8453516131267,2912.202109587379],[209.00810393271968,1974.10378333088],[223.93345278780907,2502.4338930523954],[298.0916665615514,2097.919072718825],[360.9058210486546,2838.4598475145176],[386.0190741014667,2187.9722705306485],[423.04525767313316,3944.3186331484467],[437.40420333482325,3937.765059605241],[455.21882000472397,2188.473518001847],[459.38566339947283,3003.854748811573],[464.1441978109069,2934.351959761232],[465.4710515299812,2361.153013668023],[466.02466297568753,3137.464157890063],[491.82459705369547,2878.4439694555476],[541.4860712960362,2522.9820609721355],[551.3364084893838,2757.998965774197],[570.7517157262191,2659.64185385732],[577.4510794011876,2798.8936913213693],[583.1850875434466,3110.042199311778],[649.0964800678194,3514.190862198826],[677.0147916101851,1807.2286524605006],[678.5998179740272,2727.9745403276756],[699.3830073433928,2817.6663268608972],[701.9954012897797,2535.7376247448847],[716.9313880237751,2885.0957016712055],[750.3461188804358,2679.5615345779806],[769.6681254692376,2697.1295314519666],[784.2930271374062,2615.7209277939983],[786.4248016900383,3833.2014452912845],[798.393927291967,2389.9772111764178],[807.2088527288288,2647.5650321901776],[868.3269708864391,2476.2434318279848],[878.1054363534786,2043.999905244913],[889.4545843028463,2403.465572462883],[935.1006186031736,2058.5645549544133],[959.3113043615595,1627.751961039845],[979.5140874614008,1563.6573533369228],[984.3606874970719,2431.559438982047],[987.6024256092496,2289.605180653278],[1004.0939008868299,3747.06970944535],[1009.4348720218986,3694.806930696126],[1016.7049492406659,3392.070827732794],[1023.0909565887414,1937.81431782851],[1046.4772879835218,3703.9131555301137],[1050.3355574598536,2216.6394407451153],[1051.7176553569734,3808.306959137786],[1052.4737710994668,1583.3654114091769],[1053.677305744961,2660.817908097524],[1061.2587249041535,2997.9008693108335],[1067.0956083345227,3758.1344684604555],[1094.5379083808511,2891.1802707188763],[1093.6567403264344,3299.6844831677154],[1108.2062314171344,1373.0497084828094],[1110.3373845410533,1287.51665808307],[1114.3535425402224,1867.9545633560047],[1118.9396175420843,1980.3575226031244],[1140.7695110347122,2855.865761479363],[1146.0725241862237,1444.8316583149135],[1147.0710008963943,2216.531025175471],[1167.11514284648,2611.7502180011943],[1178.0191852040589,1697.2028194423765],[1180.529046626296,2615.18366618827],[1213.5245922827162,3735.3729545082897],[1216.6541802557185,1006.678678940516],[1246.2176123252138,2629.7493048715405],[1502.2305704778992,1492.7495799604803],[1512.9509848197922,1991.5237947404385],[1518.2607883512974,1099.263274767436],[1526.944195786491,1073.889401085209],[1533.8571063042618,1480.7569858049974],[1534.3653878108598,1939.0189130334184],[1541.7519925902598,1599.7759458101355],[1551.0680876597762,1834.9967712769285],[1577.393716125749,1397.0736815771088],[1594.8448854750022,1691.2797144292854],[1613.083566670306,1540.305962823797],[1624.1343005797826,912.1163803385571],[1648.0513435048051,974.9634953071363],[1693.402503860183,1420.7003645673394],[1720.914616277907,1572.8076540301554],[1724.6110629276372,1306.1647451608442],[1735.1228090412915,837.4167392761447],[1752.0377406645566,1491.5796436457895],[1802.8411970981397,1497.3620145753957],[1831.2906708936207,1339.7579854615033],[1866.2662191288546,1448.9427844765596],[1884.6868529058993,1174.6404779315926],[2390.557825289201,3699.0694838003255],[2458.2217092090286,3635.031764315907],[2540.3827221780084,2093.3205555095337],[2549.1625552638434,3735.498257429339],[2574.197290342301,3506.1013209554367],[2740.044918920845,3420.2998579218984],[2806.5833607921377,1604.4023598381318],[2854.1803814065643,1428.2797219166532],[2889.543859900441,3788.6427380349487],[2891.6068414831534,1492.6517278384417],[2910.1909730201587,3761.7835276345722],[2940.793194655329,3777.9273967682384],[2951.3397170687094,1639.9219763227738],[2984.177912889514,1425.8556545898318],[2994.379106452223,3333.705765753053],[3044.4124529771507,3235.0511641730554],[3063.2007127734832,1315.254891882185],[3063.273725884501,2708.8211458777077],[3090.575733692851,3248.851058200933],[3092.862081979867,1325.7930640075356],[3093.8923223814927,1143.864205331076],[3110.0078403335065,2292.2243136125617],[3110.152490737848,3322.147448658012],[3112.7782726171426,1117.6559568927623],[3152.9366258974187,1183.126341344323],[3170.5514828017913,2439.4970831801184],[3180.349539513234,1361.9027003473602],[3185.4648747937754,1498.5081947268918],[3211.2225820678286,2226.530591429211],[3227.117695578374,989.7560957041569],[3229.6503778141923,3214.6697049257345],[3237.4074223628268,986.6451981910504],[3248.538953805808,2285.5825817207806],[3305.509440441616,2107.755547413137],[3313.3302315669134,2919.051184521988],[3323.4840039289556,1780.0138254477642],[3328.472457604017,1652.804765901994],[3352.9494450357743,2016.8048517610878],[3418.03290535789,879.610775614623],[3420.269554724917,1762.168755571358],[3427.8849712335505,3011.168198395986],[3435.9484694735147,926.6330608450808],[3480.4891186906025,1607.1650977991521],[3488.106344072148,1309.7293613189831],[3490.447906733025,1911.4560775649734],[3529.004399069585,1102.6283209049143],[3549.591079189442,3114.4872080464847],[3661.621639313642,1172.1109075839631],[3869.0507425088435,3136.834682532586]],"maple-yellow-brown":[[17.047724584117532,4046.603469155729],[110.35668308939785,3932.0894100903533],[153.87946728197858,3467.11867946852],[231.02183551620692,2906.1604558206163],[238.2531138351187,2911.1783369355835],[239.90363735798746,383.3332672920078],[245.88134620524943,1299.6927694580518],[259.1887397300452,943.632925985381],[272.3189241918735,523.8367604161613],[272.1924806195311,3161.4111634762958],[272.04819338722154,2836.4104871344753],[275.4290451956913,3518.2721421639435],[283.6940457923338,3555.8511914056726],[299.9949178355746,798.3969268766232],[318.62773427693173,3381.7557345512323],[382.7180212684907,3972.7440769076347],[409.9023607731797,961.7726645357907],[438.742683832068,1554.1358013553545],[463.505429897923,1530.5884459838271],[466.43912405427545,237.29579808330163],[482.2283021067269,1291.9260542234406],[484.9272692101076,3619.6738466457464],[513.3158137607388,985.7020508968271],[517.0053368299268,1950.9154920396395],[521.1745834904723,1942.2113446248695],[522.2093159975484,133.37212341837585],[524.4138116249815,1351.8905978356488],[534.0594565165229,1814.043092010077],[546.6230546059087,1997.459699306637],[579.7249136883765,187.44542098790407],[637.0720020332374,2308.375700136181],[653.102769005578,65.92694864515215],[674.5216575972736,1303.2570098927245],[689.2559357336722,1166.1548553090543],[754.6262213131413,2191.570407648571],[756.374128730502,1381.2514975620434],[828.1363306483254,1389.3394473590888],[845.8048169682734,1453.088278926909],[856.7553621763363,3827.8624881524593],[886.043079322204,1246.2832760945894],[891.1187707846984,1082.8072463264689],[963.5471513955854,1168.4264022628777],[1036.1582120428793,1084.1245471476577],[1036.5486892559566,291.30873157503083],[1069.1869172053412,231.05873189121485],[1117.7118278485723,124.37798911100253],[1205.3717122031376,2076.894414678216],[1250.9780514365993,2217.017802449409],[1276.5967919002287,1955.4644194194116],[1282.076940834988,3969.1570296604186],[1324.1584169846028,2079.3310850081034],[1345.038798279129,2473.957967246417],[1371.1194924800657,2419.214953333605],[1376.7169079883024,2063.3658061604947],[1386.5229371841997,1790.1204961608164],[1406.4981167712249,3062.9258407508023],[1405.9089012513869,3115.8063420471735],[1409.3786892346106,2558.595748454798],[1413.1153138563968,1756.5383500694297],[1435.0256919837557,1001.1211425769143],[1466.3387922826223,2994.7260945248418],[1493.4960779985413,2124.42404125724],[1493.4362036632374,2864.2040305882692],[1574.8425645064563,933.3407862996683],[1583.2890723687597,2697.784454252105],[1596.3262354610488,880.4175266190432],[1613.869573018048,1881.4407902080566],[1682.0995560460724,2845.046930056531],[1702.4078370421194,2816.731015366502],[1778.2787238107994,2837.9054403067566],[1783.872918785084,2631.503213936463],[1783.2882803208195,2876.8190439487807],[1786.1322819935158,2821.2875792845152],[1811.5591711681336,3009.8607299346477],[1863.0565168200992,2739.533074551262],[1883.3683171952143,2933.110748332925],[1897.2285694284365,2736.5025443518534],[1988.434061564505,2569.3080521496013],[2017.0145117589273,2581.767447649967],[2021.6166466888972,3476.46903285617],[2033.0201141685247,1415.489922001958],[2054.7663989276625,3473.870363255497],[2121.0296488814056,2881.4759811125696],[2155.0347405299544,2753.463732553646],[2213.8062547147274,3467.8553364500403],[2239.4626725800335,3459.242208016105],[2245.2035453300923,2682.5343411364593],[2252.6651413217187,3079.3165144277737],[2293.368654305581,2788.4325552284718],[2315.708492730744,2669.455028289929],[2381.211782686878,2628.6810167538933],[2384.2662324081175,3623.0821332056075],[2398.4810480885208,2905.200829718262],[2437.354530867189,3182.381026632618],[2489.2109044739045,3168.3698343387805],[2495.192264735233,3031.762344442308],[2496.5054235523567,3116.0307417535223],[2536.867794826161,2923.654868185986],[2620.2213386520743,3152.782428782899],[2662.229511753656,1671.9772189543582],[2723.0024488139898,1435.9389273575507],[2724.853557599243,2878.536398745142],[2736.3089079568163,3047.1159890517592],[2750.2122683129273,3120.463969281409],[2752.0116134714335,2820.7908957423642],[2765.011557872407,2761.675575323403],[2771.4094269121997,2165.449871293269],[2790.9450948867016,2908.7341402638704],[2804.811917789746,3143.6260356083512],[2814.4652875354514,2860.757566704415],[2826.6046625324525,2738.6164415525272],[2855.255948024802,1855.457837793976],[2866.097336326726,2302.6655941554345],[2879.842845534906,1912.359646848403],[2932.0096683287993,2695.2408846467733],[2952.951744674705,2467.3013573731296],[2956.393806830514,1991.7466588527896],[2970.713933426887,2959.576987975277],[2972.4182712873444,1927.7253444027156],[2979.1360422666185,2673.435916674789],[2982.3844097042456,2877.991147871129],[3002.0333771267906,1802.5090362122282],[3013.0541623984464,1658.7094402471557],[3031.7220714064315,3005.165942489635],[3059.975555021316,2126.2666435358115],[3077.8419043351896,3574.048490385525],[3088.8534322101623,3523.305791962426],[3107.8243958782405,2192.655796546489],[3108.211620213464,748.6139456378296],[3117.884415864013,1707.8758651562966],[3152.5686359903775,2841.7315371651202],[3191.262500942219,1643.6067500193603],[3367.777301148046,3299.532367689535],[3375.3753050807863,3275.9997699367814],[3449.1008797558025,2772.9104543216527],[3519.9995463481173,2840.462435657624],[3554.2294222577475,3019.4195706229657],[3609.9945867834613,1253.70523390593]],"maple-yellow-gray":[[90.30865972070023,1043.0971791287884],[111.31515237083659,3893.549044321757],[135.44791442435235,1182.0377388591878],[151.02439611917362,1159.1422766707838],[153.96874625608325,1175.4688379615545],[177.70311442343518,190.7514297021553],[180.99065647181123,3082.859799844213],[217.5490102893673,2922.7458041179925],[236.3993701590225,2811.541432702914],[247.4587906911038,3646.536236093845],[249.38586139073595,1211.3399460371584],[265.70549136120826,847.3632657337002],[271.932019345928,1051.9215896674432],[287.3053757632151,1317.2411520360038],[299.60809288173914,1096.0970121077262],[321.7226324551739,3176.203604555689],[345.5734788067639,434.8398298327811],[357.5277526737191,3628.4835673002526],[377.1985498168506,1033.2195716602728],[380.17698258999735,1044.5202747820877],[429.2606228948571,1833.4990655425936],[431.3569785570726,264.5264264694415],[482.16251374129206,2090.358769511804],[512.670095232781,1208.770694272127],[523.0214998065494,206.02633212134242],[535.8303979742341,1015.2816979316995],[559.4601141694002,1537.515121833887],[570.0557367373258,1564.2647862862796],[587.5297137782909,1282.7789385449141],[609.997990949545,2063.6952468534],[641.7147716488689,2249.888115941081],[668.1437716381624,59.544897567946464],[675.3702217433602,3938.1272708647884],[689.5624466524459,1349.831942693796],[717.5438337363303,1512.921518161893],[728.4232439305633,1443.3430664124899],[727.0341595616192,2233.892576132901],[742.4141256520525,2243.4670265824534],[757.0125912460499,2213.7509254398756],[821.6487811827101,1421.8596981335431],[828.7950935536064,1425.5015423316509],[892.7310738824308,1324.4172607767396],[908.1733255041763,1262.6024738657288],[914.2023411071859,1221.3438161513768],[954.0871574212797,1181.5025520757772],[960.0786526561715,144.94284494174644],[966.4842362552881,3645.4991972898133],[982.2835738002323,1322.407765390817],[1039.005809350405,1074.256039316766],[1091.5314458501525,275.5166302234866],[1177.8183159832843,3353.5685034203343],[1216.4190428936854,3315.9213284021243],[1244.7043042196892,3053.6149913035333],[1245.8615298015065,3158.8947888971306],[1318.2057006796822,1832.127381395083],[1336.0868226476014,3105.8348820521496],[1368.1947613041848,1859.4894811920822],[1414.15894490527,3089.8110445262864],[1464.9434429742396,2593.0635146410204],[1473.8894443549216,2951.3300654958],[1503.9856654312462,2779.150908577256],[1573.3220523190685,2680.5775026218034],[1671.879038728308,2906.311615820043],[1732.2133670607582,2615.957580804359],[1787.750007437542,2710.413531862665],[1850.4624360213056,2993.7810365967453],[1874.3067924203351,2853.6383491102606],[1892.8210704321973,2653.7568648145534],[1897.8473526560701,1097.8914949013852],[1938.316661184188,784.4314397047274],[1956.3950361087918,2700.3554833633825],[1959.1097241253592,2648.0706700962037],[2019.7418418601155,2642.8245861819014],[2021.9634954263456,2653.995772608556],[2061.3453862112947,3447.5049951784313],[2073.872494114097,2740.508461389225],[2126.702915706672,3195.4054635837674],[2165.529473635368,2972.8753406056203],[2168.796956195496,2565.0515936994925],[2186.0906406012364,2734.353088876698],[2188.2586794742383,2683.4825557903387],[2196.1435900134966,3419.7806649678387],[2267.2759206057526,2404.274791092612],[2277.0973435216583,2934.780894900672],[2288.099707149435,3157.835085360799],[2361.3079147669487,2740.41070005903],[2371.0587927955203,3604.4718305431306],[2380.0114887827076,2830.5602371240966],[2392.7480436200276,2847.7482151039876],[2449.9477578350343,2946.134210500866],[2485.3916378952563,2765.2930742800236],[2499.871927637607,2806.797903112136],[2516.9236256512813,3207.0108140017837],[2524.403034233488,2333.7138658845797],[2549.940330174286,1875.4864065926522],[2583.424757751636,3361.3408031789586],[2601.8284667273983,2128.404575362336],[2609.684845087584,2959.720377956517],[2637.0105479303747,2167.388459865004],[2680.612781352829,2965.9506844300777],[2687.9060597755015,2100.805671722628],[2803.04595656367,2973.8175113541074],[2807.4769184784964,3153.1060095024295],[2846.6020794324577,3022.91332532838],[2866.8547541559674,1871.5151582793333],[2866.3829258331098,2626.6663469420746],[2900.563164769672,2308.912539121695],[2957.4582613864914,2507.5226791240275],[2958.393939563539,2244.2801940091886],[2968.6359798107296,2516.459990898147],[2992.7284876885824,2771.2719398997724],[3029.570708000101,1890.6515095653012],[3033.9438277673908,1167.3129754727706],[3043.0468130949885,1757.2010886589997],[3116.34778311057,3537.1168799847364],[3126.024434148334,1704.5605314983986],[3143.2413322213106,1954.9022387508303],[3150.652044341434,2107.225057361182],[3188.483745086007,2909.4615272008814],[3252.0606570392847,1650.2336624800228],[3283.089831591584,3246.1572054708377],[3406.262656253297,2597.5827282592654],[3419.1492537539452,2796.339652361814],[3479.366381286178,3193.83962125564],[3490.2886983179487,2737.5109036853537],[3492.7679687840864,2845.8680935236625],[3495.2601707829162,2832.691957609728],[3505.7582931187935,1803.6513580386527],[3514.2366431797855,834.3274924671277],[3565.775147587061,952.3576661078259],[3579.5844192653894,3065.035325268749],[3600.1397424233146,2885.9354095552117],[3608.9576032678597,2781.369762088638]],"oak-gray":[[96.28201553132385,3959.9677313268185],[242.199683456216,1030.2948352224194],[244.2496045595035,3488.18824085081],[260.8053855802864,1183.2411527391523],[437.81235213344917,1073.2695498471148],[491.04544369736686,476.9192724907771],[512.386093002744,524.8011265369132],[527.6360275428742,1035.5993420435116],[655.7800319320522,1515.7206407529302],[692.3650133078918,896.7695843018591],[804.5756546091288,1484.456869380083],[1125.0190240689553,343.4145837374963],[1256.877363506239,3919.059260167647],[1385.9167433013208,2110.2370826625265],[1495.4195064790547,2871.0071938862093],[1516.7161454311572,2763.4245782480575],[1885.3724904018454,2547.950912280008],[2126.0249183233827,2641.9252891270444],[2178.8560251710005,2760.8211586540565],[2189.760053235572,2893.576748961117],[2316.9215787951834,2794.648326263763],[2343.98988098884,3548.500347514171],[2363.8460697992705,3129.5856100074016],[2577.730093985796,2205.524353660643],[2635.1747874687426,2549.8119134888984],[2695.033842339646,2912.2007454531267],[2736.4307019361295,2331.524443869479],[2958.03217900265,3014.7607487747446],[2967.4967582426034,2226.855833655689],[3033.4983102995902,2040.5746773695573],[3086.3719900329597,2914.913186957594],[3620.00884616049,841.7420375784859]],"maple-green-brown":[[114.18201733799651,3633.392751646228],[131.9269793741405,3865.933816303499],[271.5811988497153,3215.3670660443604],[340.1210391111672,759.6549364803359],[428.08092586230487,832.3241403540596],[583.2908281413838,1314.1279389709234],[667.6789010735229,314.0944705433212],[704.1444687619805,1340.4860851299018],[835.8721110182814,1146.2591264522634],[840.2658471381292,171.948012012057],[1124.061352766119,3184.3384187952615],[1241.0147710372694,4039.4832783220336],[1329.2999210520647,1814.8645874597132],[1344.2655979697593,3670.6745507861488],[1381.4728979524225,2492.05421960447],[1500.9675439861603,2456.1628585965373],[1538.0764851639979,3090.4651597398333],[1559.3734944392927,2748.9108857088722],[1566.2078797752038,2519.74445934454],[1572.3522377791815,2510.230378591921],[1718.213028778322,3002.405197314918],[2115.870715193916,2810.746660020668],[2614.877717592288,2076.8903538840823],[2633.876251307316,2085.2386260693893],[2646.9082196988165,2451.5139660835266],[2656.228561511729,2414.2477812687866],[2749.831900686957,2257.1640895348974],[2924.6340170470066,3128.655234589707],[2940.098283842206,2500.952708350029],[2969.7261520684697,2510.0300789056346],[3155.557831375394,1776.8818089053966],[3539.1402591094375,3003.1124607124366]],"oak-brown":[[165.49390162806958,3837.1099415244535],[182.4509735754691,3250.3843193654902],[185.2836817726493,3211.7537185717374],[216.73355445405468,3081.3990558381192],[307.1129146879539,194.87838118057698],[386.43359879776835,300.08277255203575],[488.4642223576084,430.403399143368],[608.8902828320861,9.944174358155578],[842.3646011259407,191.40488076908514],[937.1293035633862,872.8016377701424],[1007.7890354497358,282.0873882416636],[1343.192701596301,1009.2665026909672],[1382.6670388709754,3071.169432542287],[1452.9744684696198,3106.191290926654],[1469.5593494214118,2148.091271369718],[1654.2562550972216,1862.4284021775238],[1657.027558681555,2489.6953047188],[1680.3136707665399,794.3637241413817],[2100.21504865773,3082.767591057811],[2125.2484501739964,2553.670539495535],[2135.310323184356,3410.907160188537],[2156.1445046383888,2506.928430496715],[2161.1958625284024,2654.449513953179],[2200.046860676259,2788.1286692097783],[2235.095327684656,3148.673203624785],[2329.664813932497,3492.5765127842315],[2444.9549828562886,2579.411983868573],[2527.5755195738748,1889.2263461821713],[2638.9347461867146,2743.5521601364017],[2651.794655818958,2776.833898916375],[2653.5472132242285,2366.2628045063466],[2759.0401783217676,2528.30682427343],[2788.713107935153,3123.914584861137],[2800.393356843386,2628.9636319493875],[2808.0787259014323,2053.312858278863],[2897.199285626877,2422.578944601584],[3367.504849542398,2125.550678217318],[3659.9766465257853,1256.3660474950448]]};
var resources;
var resourcesLoaded;
var totalResources;
var character;
var characterBodyAnimations;

//init();
//animate();
loadResources();

function loadResources() {
	resourcePaths = {};
	resourceRules = {};

	resourcePaths = {
		"maple-green-brown": 'resources/world/objects/maple-green-brown/maple-green-brown.js',
		"maple-green-gray": 'resources/world/objects/maple-green-gray/maple-green-gray.js',
		"maple-yellow-brown": 'resources/world/objects/maple-yellow-brown/maple-yellow-brown.js',
		"maple-yellow-gray": 'resources/world/objects/maple-yellow-gray/maple-yellow-gray.js',
		"oak-brown": 'resources/world/objects/oak-brown/oak-brown.js',
		"oak-gray": 'resources/world/objects/oak-gray/oak-gray.js',
		"pine-brown": 'resources/world/objects/pine-brown/pine-brown.js',
		"pine-gray": 'resources/world/objects/pine-gray/pine-gray.js',
		"fern": 'resources/world/objects/fern/fern.js',
		"ivy": 'resources/world/objects/ivy/ivy.js'
	}

	resourceRules = {
		"maple-green-brown": {
			minHeight: 2,
			maxHeight: 30,
			percentage: 0.5,
			scale: 5,
			scaleMin: 5
		},
		"maple-green-gray": {
			minHeight: 2,
			maxHeight: 30,
			percentage: 0.5,
			scale: 5,
			scaleMin: 5
		},
		"maple-yellow-brown": {
			minHeight: 5,
			maxHeight: 40,
			percentage: 2,
			scale: 5,
			scaleMin: 5
		},
		"maple-yellow-gray": {
			minHeight: 5,
			maxHeight: 40,
			percentage: 2,
			scale: 5,
			scaleMin: 5
		},
		"pine-brown": {
			minHeight: 55,
			maxHeight: 160,
			percentage: 2,
			scale: 5,
			scaleMin: 5
		},
		"pine-gray": {
			minHeight: 55,
			maxHeight: 160,
			percentage: 2,
			scale: 5,
			scaleMin: 5
		},
		"oak-gray": {
			minHeight: 2,
			maxHeight: 30,
			percentage: 0.5,
			scale: 5,
			scaleMin: 5
		},
		"oak-brown": {
			minHeight: 1,
			maxHeight: 30,
			percentage: 0.5,
			scale: 5,
			scaleMin: 7
		}/*,
		"fern": {
			minHeight: 0,
			maxHeight: 10,
			percentage: 20,
			scale: 2,
			scaleMin: 0.5
		}/*,
		"ivy": {
			minHeight: 0,
			maxHeight: 10,
			percentage: 20,
			scale: 1,
			scaleMin: 0.1
		}*/
	}
	
	totalResources = 0;
	for( var i in resourcePaths ) {
		totalResources++;
	}
	resourcesLoaded = 0;
	resources = {};

	var jsonLoader = new THREE.JSONLoader();

	downloadResources(jsonLoader,resourcePaths,resources);
}

var worldGenProgress = 0;
var worldGenProgressInterval;

function downloadResources(loader,paths,resources) {
	if( typeof loader == 'undefined' ||
		typeof resources == 'undefined' ||
		typeof paths == 'undefined' ) {
		return;
	}

	var index;
	for( index in paths ) {
		break;
	}

	if( typeof index == 'undefined' ) {
		// $('#loading-file').text("Randomizing Trees and Clutter");
		$('#loading-message').text('Generating World...  This will take about 1 minute.');
		setTimeout(function() {
			init();
		},50);
	} else {
		// Load next
		loader.load( paths[index], function (geometry, materials) {
			delete paths[index];
			if( resources[index] == undefined ) {
				resources[index] = {};
			}
			resources[index] = new THREE.Mesh( geometry, new THREE.MeshFaceMaterial( materials ) );
			resourcesLoaded++;
			$('#loading-message').text('Loading Resources '+resourcesLoaded+'/'+totalResources);
			console.log('RESOURCE LOAD STATUS: '+resourcesLoaded+' / '+totalResources);
			downloadResources(loader,paths,resources);
		});
	}
}

function init(){

	if( Detector.webgl ){
		renderer = new THREE.WebGLRenderer({
			antialias : true,
			preserveDrawingBuffer : true
		});
		renderer.setClearColorHex( 0xBBBBBB, 1 );
	}
	else
	{
		Detector.addGetWebGLMessage();
		return false;
	}

	renderer.setSize( window.innerWidth, window.innerHeight );
	document.getElementById('container').appendChild(renderer.domElement);

	stats = new Stats();
	stats.domElement.style.position	= 'absolute';
	stats.domElement.style.bottom	= '0px';
	document.body.appendChild( stats.domElement );

	scene = new THREE.Scene();

	camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 1, 20000 );
	scene.add(camera);

	camera.position.set(1750,200,1750);
	camera.lookAt({x:0,y:1,z:0});

	var materialTextures = [];
	materialTextures.push({
		label: 'dirt',
		url: 'resources/world/terrain/textures/basic/grass-and-rock.png',
		start: 0 // Flag
	});

	materialTextures.push({
		label: 'grass',
		url: 'resources/world/terrain/textures/basic/grass.png',
		start: 20,
		delta: 180
	});

	materialTextures.push({
		label: 'rock',
		url: 'resources/world/terrain/textures/basic/rock.png',
		start: 150,
		delta: 60
	});

	materialTextures.push({
		label: 'snow',
		url: 'resources/world/terrain/textures/basic/snow.png',
		start: 210,
		delta: 90
	});

	var material = new THREE.GenericTerrainMaterial({
		textureRepeat: 5,
		textures: materialTextures
	});

	terrainMap = new THREE.DynamicTerrainMap({
		scene: scene,
		camera: camera,
		position: {x: 0, y: 0, z: 0},
		debugMode: false,
		workerScriptLocation: 'js/includes/DynamicTerrainMapChunkWorker.js',
		chunkShowFarthest: false,
		material: material.generateMaterial(),
		detailRanges: [100,1500,2500,3500],
		chunkHoverRange: 300,
		convertToFloat: function (rgba) {
			return ( rgba.r + rgba.g + rgba.b);
		}
	});

	terrainMap.init({
		imageUrl: 'resources/world/terrain/heightmap-4700.png'
	}, function () {
		generateObjects();
	});

	// Default start pos
	// x = 795
	// z = -605

	cameraControls = new THREE.MapControls({
		camera: camera,
		moveCallback: function () {
			terrainMap.checkGeometry();
		}
	});
	cameraControls.init();
	
	// transparently support window resize
	THREEx.WindowResize.bind(renderer, camera);
	
	// Pretty it up
	var path = "resources/world/sky/sunnysky/";
	var format = '.jpg';
	var urls = [
	    path + 'px' + format, path + 'nx' + format,
	    path + 'py' + format, path + 'ny' + format,
	    path + 'pz' + format, path + 'nz' + format
	];

	skyCubemap = THREE.ImageUtils.loadTextureCube( urls );

	var shader = THREE.ShaderLib["cube"];
	shader.uniforms["tCube"].value = skyCubemap;

	// We're inside the box, so make sure to render the backsides
	// It will typically be rendered first in the mainScene and without depth so anything else will be drawn in front
	var skyMaterial = new THREE.ShaderMaterial({
	    fragmentShader : shader.fragmentShader,
	    vertexShader   : shader.vertexShader,
	    uniforms       : shader.uniforms,
	    depthWrite     : false,
	    side           : THREE.BackSide
	});

	// The box dimension size doesn't matter that much when the mainCamera is in the center.  Experiment with the values.
	skyboxMesh = new THREE.Mesh(new THREE.CubeGeometry(10000, 10000, 10000, 1, 1, 1), skyMaterial);

	scene.add(skyboxMesh);

	var light = new THREE.AmbientLight( 0xefefef ); // soft white light
	scene.add( light );

	character = new THREEx.MinecraftChar();
	character.loadSkin('resources/character/char.png');
	character.root.scale.x = character.root.scale.y = character.root.scale.z = 100;
	character.root.position.set(-100,10,-100);
	scene.add(character.root);

	characterBodyAnimations = new THREEx.MinecraftCharBodyAnimations(character);
	characterBodyAnimations.start('walk');

	return true;
}

function generateObjects() {
	
	var treeKeys = [];
	for( treeKey in resources ) {
		treeKeys.push(treeKey);
	}
	
	var lod;
	var objectX,objectY,objectZ;
	var x,y,z;
	var percentage;

	// If we've defined a list of positions above, we save ourselves some time and just
	// pull those in.
	if( typeof resourcePositions != "undefined" ) {
		for( i in resourcePositions ) {
			console.log('Handling Resource Positions: '+i);
			for( j in resourcePositions[i] ) {
				objectX = resourcePositions[i][j][0];
				objectZ = resourcePositions[i][j][1];
				objectY = terrainMap.heightAt(objectX,objectZ);

				lod = new THREE.LOD();
				lod.position.x = objectX - ( terrainMap.width() / 2 );
				lod.position.y = objectY;
				lod.position.z = objectZ - ( terrainMap.depth() / 2 );

				var object = resources[i].clone();
				object.scale.x = object.scale.y = object.scale.z = Math.random() * resourceRules[i].scale + resourceRules[i].scaleMin;
				object.updateMatrix();
				object.matrixAutoUpdate = false;
				lod.addLevel(object);

				var blank = new THREE.Object3D();
				blank.updateMatrix();
				lod.addLevel(blank,2000);
				
				lod.updateMatrix();
				lod.matrixAutoUpdate = false;
				scene.add(lod);
			}
		}

		$('#loading').hide();
		cameraControls._cameraPhi = 0.10;
		cameraControls._center = {x: -1115, y: 0, z: -385};
		animate();
		return;
	}

	resourcePositions = {};

	// Really slow but it should work to prove a concept...
	var objectCount = 0;
	for( x = 0; x < terrainMap.width(); x++ ) {
		for( z = 0; z < terrainMap.depth(); z++ ) {
			y = terrainMap.heightAt(x,z);
			var done = false;
			for( i in resourceRules ) {
				percentage = ( Math.random() * 50000 );
				if( ! done &&
					y >= resourceRules[i].minHeight &&
					y <= resourceRules[i].maxHeight &&
					percentage < resourceRules[i].percentage ) {
					// Add in a random position within 2m radius.
					objectX = Math.random() * 2 - 1 + x;
					objectZ = Math.random() * 2 - 1 + z;
					objectY = terrainMap.heightAt(objectX,objectZ);

					if( ! resourcePositions[i] ||
						typeof resourcePositions[i] == "undefined" ) {
						resourcePositions[i] = [];
					}

					resourcePositions[i].push([objectX,objectZ]);

					lod = new THREE.LOD();
					lod.position.x = objectX - ( terrainMap.width() / 2 );
					lod.position.y = objectY;
					lod.position.z = objectZ - ( terrainMap.depth() / 2 );

					var object = resources[i].clone();
					object.scale.x = object.scale.y = object.scale.z = Math.random() * resourceRules[i].scale + resourceRules[i].scaleMin;
					object.updateMatrix();
					object.matrixAutoUpdate = false;
					lod.addLevel(object);

					var blank = new THREE.Object3D();
					blank.updateMatrix();
					lod.addLevel(blank,2000);
					
					lod.updateMatrix();
					lod.matrixAutoUpdate = false;
					scene.add(lod);
					done = true;
					objectCount++;
				}
			}
		}
	}

	$('#loading').hide();
	cameraControls._cameraPhi = 0.10;
	cameraControls._center = {x: -1115, y: 0, z: -385};
	animate();
	return;

}

var i = 0;

function animate() {
	requestAnimationFrame( animate );
	render();
	characterBodyAnimations.update(1000 / 60);
	updateCameraHeight();
	stats.update();
}

function updateCameraHeight() {
	//character.root.position.set(cameraControls._center);
	//character.root.position.y = terrainMap.heightAt(character.root.position.x + terrainMap.width() / 2 , character.root.position.z + terrainMap.depth() / 2 );
	
	/*
	var terrainHeight = terrainMap.heightAt(camera.position.x + terrainMap.width() / 2 , camera.position.z + terrainMap.depth() / 2 );
	var futureTerrainHeight = terrainMap.heightAt(camera.position.x - 10.0 + terrainMap.width() / 2 , camera.position.z - 10.0 + terrainMap.depth() / 2 );
	if( camera.position.y < terrainHeight + 3 ) {
		camera.position.y = terrainHeight + 3;
	} else if ( camera.position.y < futureTerrainHeight + 3 ) {
		camera.position.y += 1.0;
	} else {
		if( camera.position.y > terrainHeight + 3 ) {
			camera.position.y -= 0.5;
		} else {
			camera.position.y = terrainHeight + 3
		}
	}
	*/
	//camera.position.y = ( camera.position.y < terrainHeight + 3 ) ? terrainHeight + 3 : ( camera.position.y > terrainHeight + 1.5 ) ? camera.position.y - 0.5 : terrainHeight + 1 ;
}

function render() {
	if( i++ % 100 == 0 ) {
		terrainMap.checkGeometry();
	}
	var angle = Date.now() / 10000;
	var radius = 1000;
	character.root.position.x = Math.cos(angle) * radius;
	character.root.position.z = Math.sin(angle) * radius;
	character.root.position.y = terrainMap.heightAt(character.root.position.x + (terrainMap.width() / 2 ), character.root.position.z  + (terrainMap.depth() / 2 ));
	character.root.rotation.y = -angle;

	// This is horribly inefficient
	scene.traverse( function ( object ) { if ( object instanceof THREE.LOD ) { object.update( camera ); } } );
	cameraControls.update();
	renderer.render( scene, camera );
}